# AutoBooks 前端开发规则与最佳实践

## 目录

- [代码组织](#代码组织)
- [组件设计](#组件设计)
- [状态管理](#状态管理)
- [API 交互](#api-交互)
- [表单处理](#表单处理)
- [性能优化](#性能优化)
- [代码质量](#代码质量)
- [职责边界](#职责边界)
- [安全最佳实践](#安全最佳实践)

## 代码组织

- [x] **按功能模块组织代码**：
  - [ ] 在 `src/features` 目录下按业务功能模块组织代码
  - [ ] 每个功能模块包含自己的组件、钩子、工具函数和类型定义

```
src/
├── features/
│   ├── invoices/
│   │   ├── components/
│   │   ├── hooks/
│   │   ├── types/
│   │   └── utils/
│   ├── banking/
│   ├── accounting/
│   └── ...
```

- [x] **共享组件分类**：
  - [ ] `src/components` 仅保留跨功能模块使用的组件
  - [ ] `src/components/ui` 用于基础UI组件
  - [ ] 功能特定的组件放在对应功能模块的 `components` 目录下

- [x] **路由组织**：
  - [ ] 保持 Next.js 的路由结构，但将页面组件逻辑移至功能模块
  - [ ] 页面组件应尽量轻量化，主要负责布局和组合功能组件

## 组件设计

- [x] **组件粒度**：
  - [ ] 遵循单一职责原则，每个组件只做一件事
  - [ ] 提取可重用的UI模式为共享组件
  - [ ] 大型页面拆分为多个小组件，保持每个组件不超过300行代码

- [x] **组件命名**：
  - [ ] 使用 PascalCase 命名组件和组件文件
  - [ ] 使用有意义且描述性的名称
  - [ ] 页面组件使用 `Page` 后缀，如 `InvoicesListPage`
  - [ ] 表单组件使用 `Form` 后缀，如 `InvoiceEditForm`

- [x] **类型定义**：
  - [ ] 为所有组件属性定义明确的接口
  - [ ] 避免使用 `any` 类型
  - [ ] 共享类型定义放在 `src/types` 或对应功能模块的 `types` 目录

## 状态管理

- [x] **通用钩子提取**：
  - [ ] 提取 `useWorkspace()` 钩子用于处理工作区上下文
  - [ ] 提取 `useSupabase()` 钩子用于获取已配置的 Supabase 客户端
  - [ ] 提取 `useAuth()` 钩子用于处理认证状态和用户信息
  - [ ] 提取 `useDashboard()` 钩子用于仪表盘通用功能

- [x] **数据获取状态管理**：
  - [ ] 统一使用 `{ data, isLoading, error }` 模式处理数据获取状态
  - [ ] 提取通用的 `useFetch` 钩子简化数据获取逻辑

- [x] **useEffect 依赖管理**：
  - [ ] 严格控制 `useEffect` 的依赖数组
  - [ ] 避免在依赖数组中包含可变引用（如函数、对象）
  - [ ] 使用 `useCallback` 和 `useMemo` 稳定化依赖项

## API 交互

- [x] **API 客户端**：
  - [ ] 为每个功能模块创建专用的 API 客户端
  - [ ] 在 `src/features/[feature]/api.ts` 中定义所有 API 调用函数
  - [ ] 使用统一的错误处理和响应转换逻辑

- [x] **数据获取策略**：
  - [ ] 使用 `SWR` 或类似库进行数据缓存和重新验证
  - [ ] 实现乐观更新以提升用户体验
  - [ ] 根据数据变更频率设置适当的重新验证策略

## 表单处理

- [x] **表单管理**：
  - [ ] 统一使用 `react-hook-form` 和 `zod` 处理表单
  - [ ] 创建通用的表单组件和钩子
  - [ ] 提取表单验证逻辑到单独的模式文件

- [x] **表单组件封装**：
  - [ ] 为 `react-hook-form` 创建包装组件，简化表单字段绑定
  - [ ] 为常见表单模式（如动态字段数组）创建通用组件

## 性能优化

- [x] **组件优化**：
  - [ ] 适当使用 `React.memo`、`useMemo` 和 `useCallback` 减少不必要的渲染
  - [ ] 使用虚拟列表（如 `react-virtualized`）渲染长列表
  - [ ] 实现组件懒加载和代码拆分

- [x] **资源加载**：
  - [ ] 使用 Next.js Image 组件优化图像加载
  - [ ] 实现预加载和延迟加载策略
  - [ ] 避免在主线程中进行昂贵的计算

## 代码质量

- [x] **代码长度**：
  - [ ] 单个文件不超过500行代码
  - [ ] 单个函数不超过50行代码
  - [ ] 单个组件不超过300行代码

- [x] **注释规范**：
  - [ ] 为复杂逻辑添加详细注释
  - [ ] 使用 JSDoc 注释公共 API 和重要函数
  - [ ] 避免注释显而易见的代码

- [x] **测试**：
  - [ ] 为关键组件和功能编写单元测试
  - [ ] 使用 React Testing Library 进行组件测试
  - [ ] 实现端到端测试验证关键用户流程

## 职责边界

- [x] **前端直连与 Edge Function 边界**：
  - [ ] 前端直连 Supabase 处理：
    - [ ] 用户认证和授权
    - [ ] 简单的数据 CRUD 操作
    - [ ] 实时数据订阅
    - [ ] 单表数据查询和过滤
  
  - [ ] 使用 Edge Function 处理：
    - [ ] 复杂的业务逻辑和数据处理
    - [ ] 需要跨多个表的复杂查询
    - [ ] 需要外部 API 集成的操作
    - [ ] 涉及敏感数据或需要额外权限验证的操作
    - [ ] 批量数据处理和长时间运行的任务

## 安全最佳实践

- [x] **数据验证**：
  - [ ] 在客户端和服务器端都实施数据验证
  - [ ] 使用 Zod 或其他库进行严格的类型验证
  - [ ] 永远不要信任用户输入

- [x] **认证和授权**：
  - [ ] 使用 Supabase 提供的认证系统
  - [ ] 实施适当的授权检查
  - [ ] 避免在客户端存储敏感信息
